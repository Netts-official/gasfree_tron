<!doctype html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GasFree Developer Documentation</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700&display=swap" rel="stylesheet">
  <style>
    /* Базовые стили */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Open Sans', sans-serif;
      background: #f4f4f4;
      color: #333;
      line-height: 1.6;
    }

    a {
      color: #007acc;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    /* Контейнер */
    .container {
      width: 90%;
      max-width: 1200px;
      margin: auto;
      padding: 20px;
      background: #fff;
    }

    /* Шапка */
    header {
      background: #007acc;
      color: #fff;
      padding: 20px 0;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 2em;
    }

    .version-switcher {
      margin-top: 10px;
    }

    .version-switcher select {
      padding: 5px;
      border-radius: 3px;
      border: none;
      font-size: 1em;
    }

    /* Боковая панель */
    nav.sidebar {
      background: #fff;
      border-right: 1px solid #ddd;
      padding: 20px;
      width: 260px;
      position: fixed;
      top: 80px;
      bottom: 0;
      overflow-y: auto;
    }

    nav.sidebar h2 {
      font-size: 1.2em;
      margin-top: 0;
      color: #007acc;
    }

    nav.sidebar .table-of-contents {
      margin-top: 20px;
    }

    nav.sidebar .table-of-contents ol {
      padding-left: 20px;
    }

    nav.sidebar .table-of-contents li {
      margin-bottom: 8px;
    }

    /* Основной контент */
    main.content {
      margin-left: 280px;
      padding: 20px;
      background: #fff;
      min-height: calc(100vh - 160px);
    }

    main.content h1,
    main.content h2,
    main.content h3,
    main.content h4,
    main.content h5,
    main.content h6 {
      color: #007acc;
      margin-top: 1.5em;
    }

    main.content p {
      margin-bottom: 1em;
    }

    /* Таблицы */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    table,
    th,
    td {
      border: 1px solid #ddd;
    }

    th,
    td {
      padding: 10px;
      text-align: left;
    }

    th {
      background: #f0f0f0;
    }

    /* Стили для кода */
    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      margin-bottom: 20px;
    }

    code {
      font-family: Consolas, Menlo, Monaco, "Courier New", monospace;
    }

    /* Футер */
    footer {
      background: #007acc;
      color: #fff;
      text-align: center;
      padding: 20px 0;
      margin-top: 20px;
    }

    /* Адаптивность */
    @media (max-width: 768px) {
      nav.sidebar {
        width: 100%;
        position: relative;
        border-right: none;
      }

      main.content {
        margin-left: 0;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="container">
      <h1>GasFree Developer Documentation</h1>
      <div class="version-switcher">
        <label for="version-select">Версия:</label>
        <select id="version-select" onchange="location = this.value;">
          <option value="index.html" selected>1.0.0</option>
          <option value="ver/v0.9/index.html">0.9.0</option>
        </select>
      </div>
    </div>
  </header>

  <nav class="sidebar">
    <h2>Содержание</h2>
    <div class="table-of-contents">
      <ol>
        <li><a href="#overview"><strong>Overview</strong></a></li>
        <li><a href="#authorization-process"><strong>Authorization Process</strong></a></li>
        <li>
          <a href="#signature-algorithm-and-provider-endpoint"><strong>Signature Algorithm and Provider
              Endpoint</strong></a>
          <ol>
            <li><a href="#31-parameters">3.1 Parameters</a></li>
            <li><a href="#32-authorization-construction-and-signature">3.2 Authorization Construction and Signature</a>
            </li>
            <li><a href="#33-provider-endpoint">3.3 Provider Endpoint</a></li>
          </ol>
        </li>
        <li><a href="#notes"><strong>Notes</strong></a></li>
        <li>
          <a href="#apis"><strong>APIs</strong></a>
          <ol>
            <li><a href="#api-authentication">API Authentication</a></li>
            <li><a href="#api-format-definition">API Format Definition</a></li>
            <li><a href="#get-apiv1configtokenall">GET /api/v1/config/token/all</a></li>
            <li><a href="#get-apiv1configproviderall">GET /api/v1/config/provider/all</a></li>
            <li><a href="#get-apiv1addressaccountaddress">GET /api/v1/address/{accountAddress}</a></li>
            <li><a href="#post-apiv1gasfreesubmit">POST /api/v1/gasfree/submit</a></li>
            <li><a href="#get-apiv1gasfreetraceid">GET /api/v1/gasfree/{traceId}</a></li>
          </ol>
        </li>
      </ol>
    </div>
  </nav>

  <main class="content">
    <article id="doc-content">
      <!-- Начало документации -->
      <h1 id="gasfree-developer-documentation">GasFree Developer Documentation</h1>
      <p style="text-align: center; margin-bottom: 40px;">Ver: 1.0.0</p>

      <div class="table-of-contents">
        <p><strong>Table of Contents</strong></p>
        <ol>
          <li><a href="#overview"><strong>Overview</strong></a></li>
          <li><a href="#authorization-process"><strong>Authorization Process</strong></a></li>
          <li>
            <a href="#signature-algorithm-and-provider-endpoint"><strong>Signature Algorithm and Provider
                Endpoint</strong></a>
            <ol>
              <li><a href="#31-parameters">3.1 Parameters</a></li>
              <li><a href="#32-authorization-construction-and-signature">3.2 Authorization Construction and
                  Signature</a></li>
              <li><a href="#33-provider-endpoint">3.3 Provider Endpoint</a></li>
            </ol>
          </li>
          <li><a href="#notes"><strong>Notes</strong></a></li>
          <li>
            <a href="#apis"><strong>APIs</strong></a>
            <ol>
              <li><a href="#api-authentication">API Authentication</a></li>
              <li><a href="#api-format-definition">API Format Definition</a></li>
              <li><a href="#get-apiv1configtokenall">GET /api/v1/config/token/all</a></li>
              <li><a href="#get-apiv1configproviderall">GET /api/v1/config/provider/all</a></li>
              <li><a href="#get-apiv1addressaccountaddress">GET /api/v1/address/{accountAddress}</a></li>
              <li><a href="#post-apiv1gasfreesubmit">POST /api/v1/gasfree/submit</a></li>
              <li><a href="#get-apiv1gasfreetraceid">GET /api/v1/gasfree/{traceId}</a></li>
            </ol>
          </li>
        </ol>
      </div>

      <!-- 1. Overview -->
      <h2 id="overview">1. Overview</h2>
      <p>
        GasFree предоставляет решение для перевода токенов TRC-20/ERC-20 без необходимости оплаты комиссий в нативном
        токене.
        Документация описывает взаимодействие между GasFree аккаунтами, Service-Providers, кошельками и пользователями.
      </p>
      <p style="text-align: center;"><em>Figure 1. GasFree Framework</em></p>
      <p>
        <strong>GasFree Account:</strong> генерируется по специальному алгоритму и управляется EOA-адресом пользователя.
      </p>
      <p>
        <strong>Service-Provider:</strong> собирает авторизации перевода и отправляет транзакции в блокчейн, оплачивая
        комиссии.
      </p>
      <p>
        <strong>Wallet:</strong> предоставляет интерфейс для проверки баланса, подписания авторизации и других функций.
      </p>

      <!-- 2. Authorization Process -->
      <h2 id="authorization-process">2. Authorization Process</h2>
      <p>
        Интеграция GasFree в кошелёк включает построение, подпись и отправку авторизации перевода. Основные шаги:
      </p>
      <ol>
        <li>
          <strong>Prerequisite:</strong>
          <ul>
            <li>Вызов <code>/api/v1/config/token/all</code> для получения списка поддерживаемых токенов.</li>
            <li>При отсутствии поддержки токена – вывод пользователю ссылки на <a href="https://gasfree.io/withdraw"
                target="_blank">страницу вывода</a>.</li>
            <li>Вызов <code>/api/v1/config/provider/all</code> для получения списка Service-Providers.</li>
            <li>Аккаунт GasFree по умолчанию не активен и активируется при первом переводе (с доп. комиссией).</li>
          </ul>
        </li>
        <li>
          <strong>Preparation:</strong>
          <ul>
            <li>Вызов <code>/api/v1/address/{accountAddress}</code> для получения информации об аккаунте и построения
              авторизации.</li>
          </ul>
        </li>
        <li>
          <strong>Sign authorization:</strong>
          <ul>
            <li>Подпись авторизации согласно EIP712 (подробнее в разделе 3.2).</li>
          </ul>
        </li>
        <li>
          <strong>Submit authorization:</strong>
          <ul>
            <li>Отправка подписанной авторизации через <code>/api/v1/gasfree/submit</code>.</li>
          </ul>
        </li>
        <li>
          <strong>Handling provider response:</strong>
          <ul>
            <li>В случае успеха – получение уникального <code>traceId</code> для отслеживания статуса.</li>
            <li>При ошибке – уведомление пользователя о неуспешной авторизации.</li>
          </ul>
        </li>
        <li>
          <strong>Monitoring:</strong>
          <ul>
            <li>Вызов <code>/api/v1/gasfree/{traceId}</code> для проверки статуса авторизации.</li>
          </ul>
        </li>
      </ol>

      <!-- 3. Signature Algorithm and Provider Endpoint -->
      <h2 id="signature-algorithm-and-provider-endpoint">3. Signature Algorithm and Provider Endpoint</h2>

      <h3 id="31-parameters">3.1 Parameters</h3>
      <p>
        Параметры авторизации для перевода, приведённые в таблице ниже:
      </p>
      <table>
        <thead>
          <tr>
            <th>Parameter</th>
            <th>TRON - mainnet</th>
            <th>TRON - Nile testnet</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>chainId</td>
            <td>728126428</td>
            <td>3448148188</td>
          </tr>
          <tr>
            <td>verifyingContract</td>
            <td>TFFAMQLZybALaLb4uxHA9RBE7pxhUAjF3U</td>
            <td>THQGuFzL87ZqhxkgqYEryRAd7gqFqL5rdc</td>
          </tr>
        </tbody>
      </table>
      <p style="text-align: center;"><em>Table 1. GasFree Transfer Authorization Parameters</em></p>

      <h3 id="32-authorization-construction-and-signature">3.2 Authorization Construction and Signature</h3>
      <p><strong>General structure</strong></p>
      <p><em>MessageDomain:</em></p>
      <pre><code>const Permit712MessageDomain = {
  name: 'GasFreeController',
  version: 'V1.0.0',
  chainId: 3448148188,
  verifyingContract: 'THQGuFzL87ZqhxkgqYEryRAd7gqFqL5rdc'
};</code></pre>
      <p><em>MessageTypes:</em></p>
      <pre><code>const Permit712MessageTypes = {
  PermitTransfer: [
    { name: 'token', type: 'address' },
    { name: 'serviceProvider', type: 'address' },
    { name: 'user', type: 'address' },
    { name: 'receiver', type: 'address' },
    { name: 'value', type: 'uint256' },
    { name: 'maxFee', type: 'uint256' },
    { name: 'deadline', type: 'uint256' },
    { name: 'version', type: 'uint256' },
    { name: 'nonce', type: 'uint256' }
  ]
};</code></pre>
      <p><em>Message body:</em></p>
      <pre><code>const message = {
  token: 'TXYZopYRdj2D9XRtbG411XZZ3kM5VkAeBf',
  serviceProvider: 'TKtWbdzEq5ss9vTS9kwRhBp5mXmBfBns3E',
  user: 'THvMiWQeVPGEMuBtAnuKn2QpuSjqjrGQGu',
  receiver: 'TMDKznuDWaZwfZHcM61FVFstyYNmK6Njk1',
  value: '90000000',
  maxFee: '20000000',
  deadline: '1728638679',
  version: 1,
  nonce: 0
};</code></pre>
      <p><strong>Sign with Wallet</strong></p>
      <p>Подпишите вышеописанное сообщение с помощью TRON-кошелька (например, через TronLink):</p>
      <pre><code>const signature = await window.tron.tronWeb.trx._signTypedData(
  Permit712MessageDomain,
  Permit712MessageTypes,
  message
); // Удалите префикс "0x", если он присутствует</code></pre>

      <h3 id="33-provider-endpoint">3.3 Provider Endpoint</h3>
      <p>
        Для взаимодействия с сервисом используйте следующие API-эндпоинты:
      </p>
      <ul>
        <li>TRON mainnet: <a href="https://openapi.gasfree.io" target="_blank">https://openapi.gasfree.io</a></li>
        <li>TRON Nile testnet: <a href="https://test-nile.gasfree.io" target="_blank">https://test-nile.gasfree.io</a>
        </li>
      </ul>
      <p><em>Примечание: текущая реализация доступна только в сети TRON. В будущем планируется поддержка Ethereum и
          других EVM-сетей.</em></p>

      <!-- 4. Notes -->
      <h2 id="notes">4. Notes</h2>
      <ol>
        <li style="color: red;"><strong>Не рекомендуется предоставлять тестовую среду пользователям.</strong></li>
        <li><strong>Перед отправкой авторизации убедитесь в правильности баланса и статуса аккаунта.</strong></li>
      </ol>
      <p><strong>Все суммы указаны в наименьших единицах.</strong></p>

      <!-- 5. APIs -->
      <h2 id="apis">5. APIs</h2>

      <h3 id="api-authentication">API Authentication</h3>
      <p>
        После получения доступа вы получите пару ключей: <strong>API Key</strong> и <strong>API Secret</strong>.
        Для формирования запроса используется следующий HTTP-заголовок:
      </p>
      <pre><code>{
  "Timestamp": 1731912286, // сек.
  "Authorization": "ApiKey {api_key}:{signature}"
}</code></pre>
      <p><strong>API Signature and Authentication</strong></p>
      <ol>
        <li>Постройте строку для подписи из метода, пути и временной метки.</li>
        <li>Подпишите строку с помощью HMAC-SHA256 и base64-кодирования.</li>
        <li>Добавьте подпись в заголовок запроса.</li>
      </ol>
      <p><strong>Пример (Python):</strong></p>
      <pre><code>import hmac
import hashlib
import base64
import time
import requests

API_KEY = 'YOUR_API_KEY'
API_SECRET = 'YOUR_API_SECRET'

method = 'GET'
path = '/api/v1/config/token/all'
timestamp = int(time.time())
message = f'{method}{path}{timestamp}'

signature = base64.b64encode(
    hmac.new(
        API_SECRET.encode('utf-8'),
        message.encode('utf-8'),
        hashlib.sha256
    ).digest()
).decode('utf-8')

url = 'https://test-nile.gasfree.io' + path
headers = {
  'Timestamp': str(timestamp),
  'Authorization': f'ApiKey {API_KEY}:{signature}'
}

response = requests.get(url, headers=headers)
print(response.json())</code></pre>

      <h3 id="api-format-definition">API Format Definition</h3>
      <p>
        При нормальной работе API возвращает HTTP код <code>200</code>. Ошибки отображаются в теле ответа.
      </p>
      <pre><code>{
  "code": 200, // 200: OK, 400: ошибка ввода, 500: ошибка сервера
  "reason": null, // название исключения, если есть
  "message": "",  // подробности ошибки
  "data": ""      // данные API, или null
}</code></pre>

      <h3 id="get-apiv1configtokenall">GET /api/v1/config/token/all</h3>
      <p>Получение списка всех поддерживаемых токенов.</p>
      <ul>
        <li><strong>Параметры запроса:</strong> отсутствуют</li>
        <li><strong>Возвращает:</strong> объект с массивом <code>tokens</code></li>
      </ul>
      <p><em>Описание полей токена:</em></p>
      <ul>
        <li>tokenAddress: адрес контракта токена</li>
        <li>activateFee: комиссия за активацию (наименьшая единица)</li>
        <li>transferFee: комиссия за перевод</li>
        <li>symbol: название токена</li>
        <li>decimal: точность токена</li>
      </ul>
      <pre><code>{
  "code": 200,
  "reason": null,
  "message": null,
  "data": {
    "tokens": [
      {
        "tokenAddress": "TXYZopYRdj2D9XRtbG411XZZ3kM5VkAeBf",
        "createdAt": "2024-10-09T08:14:12.560+00:00",
        "updatedAt": "2024-10-09T08:14:12.560+00:00",
        "activateFee": 10000000,
        "transferFee": 10000000,
        "supported": true,
        "symbol": "USDT",
        "decimal": 6
      }
    ]
  }
}</code></pre>

      <!-- Далее следуют остальные разделы API (см. оригинальную документацию) -->

      <h3 id="get-apiv1configproviderall">GET /api/v1/config/provider/all</h3>
      <p>Получение списка всех поддерживаемых Service-Providers.</p>
      <ul>
        <li><strong>Параметры запроса:</strong> отсутствуют</li>
        <li><strong>Возвращает:</strong> объект с массивом <code>providers</code></li>
      </ul>
      <!-- Остальное содержание документации API следует аналогичной структуре -->

    </article>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 GasFree. Все права защищены.</p>
    </div>
  </footer>

  <!-- Скрипты для интерактивности (при необходимости) -->
  <script>
    // Пример: обработчик смены версии
    document.getElementById('version-select').addEventListener('change', function () {
      window.location.href = this.value;
    });
  </script>
</body>

</html>